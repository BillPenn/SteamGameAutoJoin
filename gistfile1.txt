function FindGameID()
{
	// ping github
}

function CheckAndLeaveCurrentGame( callback )
{
	var currentgame = JoinGame.toString().match(/'[0-9]*'/)[0].replace(/'/g, '');
	console.log('Current Game: ' + currentgame);

	if (currentgame == 0)
		return callback();

	$J.post(
		'http://steamcommunity.com/minigame/ajaxleavegame/',
		{ 'gameid' : currentgame, 'sessionid' : g_sessionID }
	).done( function() { callback(); }
	);
}

function JoinGameID( gameid )
{
	CheckAndLeaveCurrentGame( function() {
		JoinGameID_Real( gameid );
	});
}

function JoinGameID_Real( gameid )
{
	console.log('Trying to join room ' + gameid);

	$J.post(
		'http://steamcommunity.com/minigame/ajaxjoingame/',
		{ 'gameid' : gameid }
	).done( function( json ) {
			if ( json.success == '1' )
			{
				top.location.href = 'http://steamcommunity.com/minigame/towerattack/';
				return;
			}

			console.log('Failed to join room ' + gameid);
			JoinGameID_Real( gameid );
		}
	).fail( function( jqXHR ) {
			var responseJSON = jqXHR.responseText.evalJSON();
			if ( responseJSON.success == '24' && responseJSON.errorMsg )
				console.log( responseJSON.errorMsg );
			else if ( responseJSON.success == '25' )
				console.log('Failed to join room ' + gameid + ' - Full');
			else
				console.log('Failed to join room ' + gameid);

			JoinGameID_Real( gameid );
		}
	);
}